<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent – Bloomberg Terminal Mode</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ===== THEME ===== */

:root{
--bg:#0b1622;
--card:#102132;
--text:#e8f1fb;
--accent:#00c3ff;
--muted:#8ea2b5;
}

body.light{
--bg:#f4f7fb;
--card:#ffffff;
--text:#0b1622;
--accent:#1f4e79;
--muted:#6c7a89;
}

body{
margin:0;
padding:28px;
font-family:Inter,Arial;
background:var(--bg);
color:var(--text);
transition:.3s;
}

.container{max-width:1250px;margin:auto;}

.card{
background:var(--card);
padding:22px;
border-radius:18px;
margin-bottom:22px;
box-shadow:0 15px 40px rgba(0,0,0,.25);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:18px;
align-items:start;
}

.field{display:flex;flex-direction:column;gap:6px;}

label{font-size:12px;color:var(--muted);}

.micro{
font-size:11px;
color:var(--accent);
min-height:14px;
}

input[type=text]{
padding:10px;
border-radius:10px;
border:none;
background:#0f2133;
color:#fff;
}

body.light input[type=text]{
background:#eef3f8;
color:#000;
}

input[type=range]{width:100%;}

.chartCard{
background:var(--card);
padding:20px;
border-radius:18px;
margin-top:20px;
}

.metricValue{font-size:26px;font-weight:700;}

.toggle{
position:fixed;
top:15px;
right:15px;
background:var(--accent);
color:#fff;
padding:8px 14px;
border-radius:20px;
cursor:pointer;
font-size:13px;
}

.gauge{
width:160px;height:160px;border-radius:50%;
background:conic-gradient(#2ecc71 0deg,#f1c40f 180deg,#ff4d4d 360deg);
display:flex;align-items:center;justify-content:center;margin:auto;
}
.gaugeInner{
width:120px;height:120px;border-radius:50%;
background:var(--bg);
display:flex;align-items:center;justify-content:center;
font-size:28px;font-weight:700;
}

.verdict{text-align:center;font-size:20px;font-weight:700;margin-top:10px;}

.savingsBox{
margin-top:10px;
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:12px;
}

.sBlock{
background:rgba(255,255,255,.04);
padding:12px;
border-radius:10px;
}

</style>
</head>

<body>

<div class="toggle" onclick="toggleTheme()"> / </div>

<div class="container">

<div class="card">

<div class="grid">

<div class="field">
<label>Lease Amount</label>
<input id="leaseAmount" class="currency">
<input type="range" id="leaseAmountRange" min="100000" max="5000000" step="50000">
</div>

<div class="field">
<label>Loan Amount</label>
<input id="loanAmount" class="currency">
<input type="range" id="loanAmountRange" min="0" max="3000000" step="50000">
</div>

<div class="field">
<label>Loan Interest %</label>
<input id="loanRate" class="percent">
<div id="emiLabel" class="micro"></div>
<input type="range" id="loanRateRange" min="1" max="20" step="0.1">
</div>

<div class="field">
<label>Opportunity Cost %</label>
<input id="oppRate" class="percent">
<div id="oppLabel" class="micro"></div>
<input type="range" id="oppRateRange" min="1" max="20" step="0.1">
</div>

<div class="field">
<label>Risk Premium %</label>
<input id="riskPremium" class="percent">
<div id="riskLabel" class="micro"></div>
<input type="range" id="riskPremiumRange" min="0" max="20" step="0.1">
</div>

<div class="field">
<label>Market Rent</label>
<input id="marketRent" class="currency">
<input type="range" id="marketRentRange" min="5000" max="100000" step="1000">
</div>

<div class="field">
<label>Maintenance</label>
<input id="maintenance" class="currency">
<input type="range" id="maintenanceRange" min="0" max="20000" step="500">
</div>

<input id="loanTenure" placeholder="Loan Tenure Months">
<input id="leaseTenure" placeholder="Lease Tenure Months">
<input id="withholding" class="percent" placeholder="Withholding %">
<input id="refundDelay" placeholder="Refund Delay Months">
<input id="salary" class="currency" placeholder="Take Home Salary">

</div>
</div>

<div class="card">

<div class="gauge"><div id="dial" class="gaugeInner">0</div></div>
<div id="verdict" class="verdict"></div>

<div id="results"></div>

<div class="savingsBox">
<div class="sBlock"><div class="micro">Monthly Savings</div><div id="mSave" class="metricValue"></div></div>
<div class="sBlock"><div class="micro">Yearly Savings</div><div id="ySave" class="metricValue"></div></div>
<div class="sBlock"><div class="micro">Lease Term Savings</div><div id="tSave" class="metricValue"></div></div>
</div>

</div>

<div class="chartCard"><canvas id="comparisonChart"></canvas></div>
<div class="chartCard"><canvas id="projectionChart"></canvas></div>
<div class="chartCard"><canvas id="compositionChart"></canvas></div>

</div>

<script>

/* ===== THEME ===== */
function toggleTheme(){document.body.classList.toggle("light");}

const $=id=>document.getElementById(id);

/* ===== FORMAT ENGINE ===== */

function cleanNumber(v){
return parseFloat((v||"").replace(/[,%\s,]/g,""))||0;
}
function num(id){return cleanNumber($(id).value);}
function INR(n){return " "+Math.round(n||0).toLocaleString("en-IN");}

function formatINR(n){
return " "+Number(n).toLocaleString("en-IN",{maximumFractionDigits:0});
}
function formatPercent(n){
return Number(n).toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})+"%";
}

function attachFormatter(selector,formatter){
document.querySelectorAll(selector).forEach(el=>{
let timer;
el.addEventListener("input",()=>{
clearTimeout(timer);
timer=setTimeout(()=>{
let raw=cleanNumber(el.value);
if(raw) el.value=formatter(raw);
calculate();
},300);
});
});
}
attachFormatter(".currency",formatINR);
attachFormatter(".percent",formatPercent);

/* ===== RANGE SYNC ===== */

[
"leaseAmount","loanAmount","loanRate",
"oppRate","riskPremium","marketRent","maintenance"
].forEach(id=>{
let input=$(id);
let range=$(id+"Range");
if(!range) return;

range.addEventListener("input",()=>{
input.value=range.value;
calculate();
});
input.addEventListener("input",()=>{
range.value=cleanNumber(input.value);
});
});

/* ===== ORIGINAL FINANCIAL ENGINE (UNCHANGED) ===== */

let comparisonChart,projectionChart,compositionChart;

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}
function futureValue(pmt,rate,n){
if(rate===0)return pmt*n;
return pmt*((Math.pow(1+rate,n)-1)/rate);
}

function calculate(){

const LEASE_AMOUNT=num("leaseAmount");
const LOAN_AMOUNT=num("loanAmount");
const OWN_FUNDS=Math.max(0,LEASE_AMOUNT-LOAN_AMOUNT);

const LOAN_INTEREST_RATE=(num("loanRate")/100)/12;
const LOAN_TENURE=num("loanTenure");
const LEASE_TENURE=num("leaseTenure");

const WITHHOLDING=num("withholding")/100;
const REFUND_DELAY=num("refundDelay");

const MAINTENANCE=num("maintenance");
const MARKET_RENT=num("marketRent");

const OPP_RATE=(num("oppRate")/100)/12;
const RISK_PREMIUM=num("riskPremium")/100;
const SALARY=num("salary");

/* ===== STRICT ORIGINAL MODEL ===== */

const EMI=emi(LOAN_AMOUNT,LOAN_INTEREST_RATE,LOAN_TENURE);
const totalInterest=EMI*LOAN_TENURE-LOAN_AMOUNT;

const monthlyLeaseCost=EMI+MAINTENANCE;
const monthlyExtra=monthlyLeaseCost-MARKET_RENT;

const refund=LEASE_AMOUNT*(1-WITHHOLDING);
const withholdingLoss=LEASE_AMOUNT*WITHHOLDING;

const ownOpp=OWN_FUNDS*(Math.pow(1+OPP_RATE,LEASE_TENURE)-1);

let emiOpp=0;
if(monthlyExtra>0){
emiOpp=futureValue(monthlyExtra,OPP_RATE,LEASE_TENURE)-(monthlyExtra*LEASE_TENURE);
}

const delayCost=refund*OPP_RATE*REFUND_DELAY;

const capitalLoss=totalInterest+withholdingLoss;

const totalEconomic=
capitalLoss+
ownOpp+
emiOpp+
delayCost;

const riskRent=(totalEconomic/LEASE_TENURE)*(1+RISK_PREMIUM);
const breakEven=riskRent;

const monthlySavings=MARKET_RENT-riskRent;
const yearlySavings=monthlySavings*12;
const termSavings=monthlySavings*LEASE_TENURE;

let score=MARKET_RENT>0?(monthlySavings/MARKET_RENT)*100:0;
score=Math.max(0,Math.min(100,score));

/* ===== MICRO LABELS (UI ONLY) ===== */

$("emiLabel").innerText="EMI: "+INR(EMI);
$("oppLabel").innerText="Opp Cost Impact: "+INR(ownOpp);
$("riskLabel").innerText="Risk Rent: "+INR(riskRent);

/* ===== SAVINGS PANEL ===== */

$("mSave").innerText=INR(monthlySavings);
$("ySave").innerText=INR(yearlySavings);
$("tSave").innerText=INR(termSavings);

$("dial").innerText=Math.round(score);

let verdict=" Neutral";
if(score>20) verdict=" Lease Is Winning";
if(score<5) verdict=" Rent Is Safer";
$("verdict").innerText=verdict;

/* ===== CHARTS ===== */

if(comparisonChart)comparisonChart.destroy();
comparisonChart=new Chart($("comparisonChart"),{
type:"bar",
data:{labels:["Market Rent","Risk Rent","Lease Monthly Cost"],
datasets:[{data:[MARKET_RENT,riskRent,monthlyLeaseCost]}]}
});

let proj=[];
let step=termSavings/LEASE_TENURE;
for(let i=1;i<=LEASE_TENURE;i++){proj.push(step*i);}

if(projectionChart)projectionChart.destroy();
projectionChart=new Chart($("projectionChart"),{
type:"line",
data:{labels:proj.map((_,i)=>i+1),datasets:[{data:proj}]}
});

if(compositionChart)compositionChart.destroy();
compositionChart=new Chart($("compositionChart"),{
type:"doughnut",
data:{labels:["Interest","OwnOpp","EmiOpp","Delay","Withholding"],
datasets:[{data:[totalInterest,ownOpp,emiOpp,delayCost,withholdingLoss]}]}
});

}

document.querySelectorAll("input").forEach(el=>{
el.addEventListener("input",calculate);
});

</script>
</body>
</html>