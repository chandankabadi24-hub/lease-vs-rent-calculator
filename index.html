<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent Analyst Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
font-family:Inter,Arial;
background:#f4f7fb;
margin:0;
padding:24px;
}

.container{max-width:1200px;margin:auto;}

.card{
background:#fff;
padding:22px;
margin-bottom:22px;
border-radius:14px;
box-shadow:0 8px 18px rgba(0,0,0,.06);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:12px;
}

input{
padding:12px;
border-radius:10px;
border:1px solid #ccc;
width:100%;
}

button{
background:#1f4e79;
color:white;
border:none;
padding:12px;
border-radius:10px;
font-weight:bold;
margin-top:10px;
cursor:pointer;
}

.metricLabel{font-size:13px;color:#6c7a89;margin-top:12px;}
.metricValue{font-size:20px;font-weight:700;margin-top:4px;}

.verdict{
font-size:22px;
font-weight:700;
text-align:center;
margin-top:16px;
}

.chartWrap{margin-top:20px;}

</style>
</head>

<body>

<div class="container">

<div class="card">
<h3>Inputs</h3>

<div class="grid">
<input id="leaseAmount" placeholder="Lease Amount">
<input id="loanAmount" placeholder="Loan Amount">
<input id="ownFunds" placeholder="Own Funds">
<input id="loanRate" placeholder="Loan Interest %">
<input id="loanTenure" placeholder="Loan Tenure Months">
<input id="leaseTenure" placeholder="Lease Tenure Months">
<input id="withholding" placeholder="Withholding %">
<input id="refundDelay" placeholder="Refund Delay Months">
<input id="maintenance" placeholder="Monthly Maintenance">
<input id="marketRent" placeholder="Market Rent">
<input id="oppRate" placeholder="Opportunity Cost %">
<input id="riskPremium" placeholder="Risk Premium %">
<input id="salary" placeholder="Take Home Salary Optional">
</div>

<button onclick="calculate()">Run Analysis</button>
</div>

<div class="card">
<div id="results"></div>
<div id="verdict" class="verdict"></div>
</div>

<div class="card">
<canvas id="comparisonChart"></canvas>
</div>

<div class="card">
<canvas id="projectionChart"></canvas>
</div>

<div class="card">
<canvas id="compositionChart"></canvas>
</div>

</div>

<script>

const $=id=>document.getElementById(id);

let comparisonChart,projectionChart,compositionChart;

function num(id){return parseFloat($(id).value)||0;}
function INR(n){return "â‚¹ "+Math.round(n||0).toLocaleString("en-IN");}

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}

function futureValue(pmt,rate,n){
if(rate===0)return pmt*n;
return pmt*((Math.pow(1+rate,n)-1)/rate);
}

function calculate(){

/* ===== INPUTS ===== */

const LEASE_AMOUNT=num("leaseAmount");
const LOAN_AMOUNT=num("loanAmount");
const OWN_FUNDS=num("ownFunds");

const LOAN_INTEREST_RATE=(num("loanRate")/100)/12;
const LOAN_TENURE=num("loanTenure");
const LEASE_TENURE=num("leaseTenure");

const WITHHOLDING=num("withholding")/100;
const REFUND_DELAY=num("refundDelay");

const MAINTENANCE=num("maintenance");
const MARKET_RENT=num("marketRent");

const OPP_RATE=(num("oppRate")/100)/12;
const RISK_PREMIUM=num("riskPremium")/100;
const SALARY=num("salary");

/* ===== ORIGINAL LOGIC PRESERVED ===== */

const EMI=emi(LOAN_AMOUNT,LOAN_INTEREST_RATE,LOAN_TENURE);
const totalInterest=EMI*LOAN_TENURE-LOAN_AMOUNT;

const monthlyLeaseCost=EMI+MAINTENANCE;
const monthlyExtra=monthlyLeaseCost-MARKET_RENT;

const refund=LEASE_AMOUNT*(1-WITHHOLDING);
const withholdingLoss=LEASE_AMOUNT*WITHHOLDING;

const ownOpp=OWN_FUNDS*(Math.pow(1+OPP_RATE,LEASE_TENURE)-1);

let emiOpp=0;
if(monthlyExtra>0){
emiOpp=futureValue(monthlyExtra,OPP_RATE,LEASE_TENURE)-(monthlyExtra*LEASE_TENURE);
}

const delayCost=refund*OPP_RATE*REFUND_DELAY;

const capitalLoss=totalInterest+withholdingLoss;

const totalEconomic=
capitalLoss+
ownOpp+
emiOpp+
delayCost;

const riskRent=(totalEconomic/LEASE_TENURE)*(1+RISK_PREMIUM);
const breakEven=riskRent;

const monthlySavings=MARKET_RENT-riskRent;
const yearlySavings=monthlySavings*12;
const termSavings=monthlySavings*LEASE_TENURE;

let score=MARKET_RENT>0?(monthlySavings/MARKET_RENT)*100:0;
score=Math.max(0,Math.min(100,score));

const extraCash=(Math.max(monthlyExtra,0)*LEASE_TENURE)+OWN_FUNDS;

/* ===== OUTPUT ===== */

$("results").innerHTML=`

<div class="metricLabel">EMI</div>
<div class="metricValue">${INR(EMI)}</div>

<div class="metricLabel">Risk Adjusted Rent</div>
<div>${INR(riskRent)}</div>

<div class="metricLabel">Break Even Rent</div>
<div>${INR(breakEven)}</div>

<div class="metricLabel">Monthly Savings</div>
<div class="metricValue">${INR(monthlySavings)}</div>

<div class="metricLabel">Total Extra Cash</div>
<div>${INR(extraCash)}</div>

<div class="metricLabel">Lease Efficiency Score</div>
<div>${score.toFixed(0)} / 100</div>
`;

let verdict="ðŸŸ¡ Neutral";
if(score>20) verdict="ðŸŸ¢ Lease Is Winning";
if(score<5) verdict="ðŸ”´ Rent Is Safer";

$("verdict").innerText=verdict;

/* ================= BI CHARTS ================= */

if(comparisonChart)comparisonChart.destroy();

comparisonChart=new Chart($("comparisonChart"),{
type:"bar",
data:{
labels:["Market Rent","Risk Rent","Lease Monthly Cost"],
datasets:[{
label:"Monthly Comparison",
data:[MARKET_RENT,riskRent,monthlyLeaseCost],
backgroundColor:["#3498db","#e74c3c","#2ecc71"]
}]
},
options:{animation:{duration:900}}
});

/* Projection Line */

let proj=[];
let step=termSavings/LEASE_TENURE;
for(let i=1;i<=LEASE_TENURE;i++){proj.push(step*i);}

if(projectionChart)projectionChart.destroy();

projectionChart=new Chart($("projectionChart"),{
type:"line",
data:{
labels:proj.map((_,i)=>i+1),
datasets:[{label:"Cumulative Savings Projection",data:proj}]
}
});

/* Cost Composition */

if(compositionChart)compositionChart.destroy();

compositionChart=new Chart($("compositionChart"),{
type:"doughnut",
data:{
labels:[
"Interest Cost",
"Own Funds Opportunity",
"EMI Opportunity",
"Refund Delay",
"Withholding Loss"
],
datasets:[{
data:[
totalInterest,
ownOpp,
emiOpp,
delayCost,
withholdingLoss
]
}]
}
});

}

</script>
</body>
</html>