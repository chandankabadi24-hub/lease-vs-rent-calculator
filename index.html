<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent – Aladdin Mode (Logic Pure)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;}

body{
margin:0;
padding:24px;
font-family:Inter,Arial;
background:#0b1622;
color:#e8f1fb;
}

.container{
display:grid;
grid-template-columns:380px 1fr;
gap:24px;
max-width:1500px;
margin:auto;
}

.panel{
background:rgba(18,30,44,.85);
padding:20px;
border-radius:18px;
box-shadow:0 25px 60px rgba(0,0,0,.35);
}

.controlRow{margin-bottom:16px;}

.controlFlex{
display:flex;
gap:10px;
align-items:center;
}

input[type=text]{
width:120px;
padding:8px;
border-radius:8px;
border:none;
background:#0f2133;
color:#fff;
}

input[type=range]{flex:1;}

.metricValue{
font-size:30px;
font-weight:700;
margin-top:6px;
}

.confidenceBar{
height:12px;
border-radius:20px;
background:#1a2a3a;
overflow:hidden;
margin-top:12px;
}

.confidenceFill{
height:100%;
width:0%;
background:linear-gradient(90deg,#ff4d4d,#f1c40f,#2ecc71);
transition:.4s;
}

.chartStack{
display:flex;
flex-direction:column;
gap:24px;
}

.chartCard{
background:rgba(18,30,44,.85);
padding:20px;
border-radius:18px;
min-height:320px;
}
</style>
</head>

<body>

<div class="container">

<!-- CONTROLS -->
<div class="panel">

<div class="controlRow"><label>Lease Amount</label>
<div class="controlFlex">
<input id="leaseAmountInput"><input id="leaseAmount" type="range" min="100000" max="5000000" step="50000" value="1500000">
</div></div>

<div class="controlRow"><label>Loan Amount</label>
<div class="controlFlex">
<input id="loanAmountInput"><input id="loanAmount" type="range" min="0" max="3000000" step="50000" value="1000000">
</div></div>

<div class="controlRow"><label>Loan Interest %</label>
<div class="controlFlex">
<input id="loanRateInput"><input id="loanRate" type="range" min="5" max="15" step="0.1" value="9">
</div></div>

<div class="controlRow"><label>Market Rent</label>
<div class="controlFlex">
<input id="marketRentInput"><input id="marketRent" type="range" min="5000" max="100000" step="1000" value="25000">
</div></div>

<div class="controlRow"><label>Maintenance</label>
<div class="controlFlex">
<input id="maintenanceInput"><input id="maintenance" type="range" min="0" max="15000" step="500" value="2000">
</div></div>

<div class="controlRow"><label>Opportunity Cost %</label>
<div class="controlFlex">
<input id="oppRateInput"><input id="oppRate" type="range" min="3" max="15" step="0.1" value="8">
</div></div>

<div class="controlRow"><label>Risk Premium %</label>
<div class="controlFlex">
<input id="riskPremiumInput"><input id="riskPremium" type="range" min="0" max="15" step="0.1" value="5">
</div></div>

</div>

<!-- TERMINAL -->
<div>

<div class="panel">
<div id="results"></div>
<div class="confidenceBar"><div id="confidenceFill" class="confidenceFill"></div></div>
</div>

<div class="chartStack">
<div class="chartCard"><canvas id="comparisonChart"></canvas></div>
<div class="chartCard"><canvas id="radarChart"></canvas></div>
<div class="chartCard"><canvas id="sensitivityChart"></canvas></div>
<div class="chartCard"><canvas id="monteChart"></canvas></div>
<div class="chartCard"><canvas id="compositionChart"></canvas></div>
</div>

</div>

</div>

<script>

/* ===== INPUT SYNC ===== */

const $=id=>document.getElementById(id);

function clean(v){return parseFloat((v||"").replace(/[,%\s,]/g,""))||0;}

["leaseAmount","loanAmount","loanRate","marketRent","maintenance","oppRate","riskPremium"]
.forEach(id=>{
const slider=$(id);
const input=$(id+"Input");

input.value=slider.value;

slider.addEventListener("input",()=>{
input.value=slider.value;
calculate();
});

input.addEventListener("input",()=>{
let val=clean(input.value);
if(!isNaN(val)){slider.value=val;calculate();}
});
});

/* ===== ORIGINAL FINANCIAL ENGINE (LOGIC PURE) ===== */

function num(id){return parseFloat($(id).value)||0;}
function INR(n){return " "+Math.round(n||0).toLocaleString("en-IN");}

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}

function futureValue(pmt,rate,n){
if(rate===0)return pmt*n;
return pmt*((Math.pow(1+rate,n)-1)/rate);
}

let comparisonChart,radarChart,compositionChart,sensitivityChart,monteChart;

function coreCalc(riskOverride){

const LEASE_AMOUNT=num("leaseAmount");
const LOAN_AMOUNT=num("loanAmount");
const OWN_FUNDS=Math.max(0,LEASE_AMOUNT-LOAN_AMOUNT);

const LOAN_INTEREST_RATE=(num("loanRate")/100)/12;
const LOAN_TENURE=120;
const LEASE_TENURE=24;

const WITHHOLDING=0;         // logic preserved
const REFUND_DELAY=0;        // logic preserved

const MAINTENANCE=num("maintenance");
const MARKET_RENT=num("marketRent");

const OPP_RATE=(num("oppRate")/100)/12;
const RISK_PREMIUM=riskOverride ?? (num("riskPremium")/100);

/* ===== ORIGINAL MODEL ===== */

const EMI=emi(LOAN_AMOUNT,LOAN_INTEREST_RATE,LOAN_TENURE);
const totalInterest=EMI*LOAN_TENURE-LOAN_AMOUNT;

const monthlyLeaseCost=EMI+MAINTENANCE;
const monthlyExtra=monthlyLeaseCost-MARKET_RENT;

const refund=LEASE_AMOUNT*(1-WITHHOLDING);
const withholdingLoss=LEASE_AMOUNT*WITHHOLDING;

const ownOpp=OWN_FUNDS*(Math.pow(1+OPP_RATE,LEASE_TENURE)-1);

let emiOpp=0;
if(monthlyExtra>0){
emiOpp=futureValue(monthlyExtra,OPP_RATE,LEASE_TENURE)-(monthlyExtra*LEASE_TENURE);
}

const delayCost=refund*OPP_RATE*REFUND_DELAY;

const capitalLoss=totalInterest+withholdingLoss;

const totalEconomic=
capitalLoss+
ownOpp+
emiOpp+
delayCost;

const riskRent=(totalEconomic/LEASE_TENURE)*(1+RISK_PREMIUM);

const monthlySavings=MARKET_RENT-riskRent;

let score=MARKET_RENT>0?(monthlySavings/MARKET_RENT)*100:0;
score=Math.max(0,Math.min(100,score));

return{
EMI,riskRent,monthlySavings,score,totalInterest,ownOpp,emiOpp,delayCost,withholdingLoss,
monthlyLeaseCost,MARKET_RENT
};
}

/* ===== MAIN CALCULATE ===== */

function calculate(){

const base=coreCalc();

$("confidenceFill").style.width=base.score+"%";

$("results").innerHTML=`
<div class="metricValue">${INR(base.monthlySavings)}</div>
<div>Monthly Savings</div>
<div style="margin-top:10px;">EMI: ${INR(base.EMI)}</div>
<div>Risk Rent: ${INR(base.riskRent)}</div>
`;

/* Charts */

if(comparisonChart)comparisonChart.destroy();
comparisonChart=new Chart($("comparisonChart"),{
type:"bar",
data:{labels:["Market Rent","Risk Rent","Lease Cost"],
datasets:[{data:[base.MARKET_RENT,base.riskRent,base.monthlyLeaseCost]}]}
});

if(radarChart)radarChart.destroy();
radarChart=new Chart($("radarChart"),{
type:"radar",
data:{labels:["Savings Strength","Risk Load","Efficiency"],
datasets:[{data:[base.score,(base.riskRent/base.MARKET_RENT)*100,base.score]}]}
});

let labels=[],data=[];
for(let i=0.01;i<=0.15;i+=0.01){
let t=coreCalc(i);
labels.push((i*100).toFixed(0)+"%");
data.push(t.monthlySavings);
}
if(sensitivityChart)sensitivityChart.destroy();
sensitivityChart=new Chart($("sensitivityChart"),{
type:"line",
data:{labels,datasets:[{label:"Risk Sensitivity",data}]}
});

let mc=[];
for(let i=0.02;i<=0.12;i+=0.005){
mc.push(coreCalc(i).monthlySavings);
}
if(monteChart)monteChart.destroy();
monteChart=new Chart($("monteChart"),{
type:"bar",
data:{labels:mc.map((_,i)=>i+1),datasets:[{label:"Scenario Distribution",data:mc}]}
});

if(compositionChart)compositionChart.destroy();
compositionChart=new Chart($("compositionChart"),{
type:"doughnut",
data:{labels:["Interest","OwnOpp","EmiOpp","Delay","Withholding"],
datasets:[{data:[base.totalInterest,base.ownOpp,base.emiOpp,base.delayCost,base.withholdingLoss]}]}
});

}

calculate();

</script>
</body>
</html>