<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent Fintech Decision Engine</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

/* ---------- THEME VARIABLES ---------- */

:root{
--bg:#f4f7fb;
--card:#ffffff;
--text:#0b1622;
--accent:#1f4e79;
--muted:#6c7a89;
}

body.dark{
--bg:#0b1622;
--card:rgba(255,255,255,0.05);
--text:#e6eef7;
--accent:#00d4ff;
--muted:#9fb3c8;
}

body{
margin:0;
font-family:Inter,Arial;
background:var(--bg);
color:var(--text);
padding:20px;
transition:.4s;
}

.container{max-width:1100px;margin:auto;}

h1{
text-align:center;
margin-bottom:20px;
}

.card{
background:var(--card);
border-radius:14px;
padding:22px;
margin-bottom:22px;
box-shadow:0 8px 20px rgba(0,0,0,.06);
backdrop-filter:blur(10px);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:12px;
}

input{
padding:12px;
border-radius:10px;
border:1px solid #ccc;
width:100%;
background:transparent;
color:var(--text);
}

button{
background:var(--accent);
color:white;
border:none;
padding:12px;
border-radius:10px;
font-weight:bold;
cursor:pointer;
transition:.3s;
}

button:hover{transform:scale(1.03)}

.rowSpace{margin-top:14px;}

.verdict{
font-size:24px;
font-weight:700;
margin-top:10px;
text-align:center;
}

.metric{
margin-top:8px;
font-size:16px;
color:var(--muted);
}

.bigNumber{
font-size:22px;
font-weight:700;
margin-top:12px;
}

.toggleWrap{
display:flex;
justify-content:flex-end;
margin-bottom:10px;
}

.switch{
cursor:pointer;
background:var(--accent);
color:white;
padding:8px 14px;
border-radius:20px;
font-size:14px;
}

.confidenceBar{
height:16px;
background:#ddd;
border-radius:10px;
margin-top:10px;
overflow:hidden;
}

.confidenceFill{
height:100%;
width:0%;
background:linear-gradient(90deg,#ff4d4d,#f1c40f,#2ecc71);
transition:width 1s ease;
}

</style>
</head>

<body>

<div class="container">

<div class="toggleWrap">
<div class="switch" onclick="toggleTheme()"> /  Toggle Theme</div>
</div>

<h1>Lease vs Rent Fintech Decision Engine</h1>

<div class="card">
<h3>Inputs</h3>

<div class="grid">
<input id="leaseAmount" class="currency" placeholder="Lease Amount">
<input id="loanAmount" class="currency" placeholder="Loan Amount">
<input id="loanRate" class="percent" placeholder="Loan Interest %">
<input id="loanTenure" placeholder="Loan Tenure Months">
<input id="leaseTenure" placeholder="Lease Tenure Months">
<input id="maintenance" class="currency" placeholder="Monthly Maintenance">
<input id="marketRent" class="currency" placeholder="Market Rent">
<input id="oppRate" class="percent" placeholder="Opportunity Cost %">
<input id="riskPremium" class="percent" placeholder="Risk Premium %">
</div>

<div class="rowSpace">
<button onclick="runScenario('best')">Best</button>
<button onclick="runScenario('realistic')">Realistic</button>
<button onclick="runScenario('worst')">Worst</button>
</div>

<div class="rowSpace">
<button onclick="downloadPDF()">Download Professional Report</button>
</div>

</div>

<div class="card">
<div id="results"></div>
<div id="verdict" class="verdict"></div>

<div class="metric">Confidence Score</div>
<div class="confidenceBar">
<div id="confidenceFill" class="confidenceFill"></div>
</div>

</div>

<div class="card">
<canvas id="projectionChart"></canvas>
</div>

</div>

<script>

let projectionChart;
let lastResults={};

const $=id=>document.getElementById(id);

/* ---------- THEME TOGGLE ---------- */

function toggleTheme(){
document.body.classList.toggle("dark");
}

/* ---------- FORMAT ENGINE ---------- */

function clean(v){return parseFloat((v||"").replace(/[,%\s,]/g,""))||0;}
function INR(n){return " "+Math.round(n||0).toLocaleString("en-IN");}
function PCT(n){return (n||0).toFixed(2)+"%";}

document.querySelectorAll(".currency").forEach(i=>{
i.addEventListener("blur",()=>{let v=clean(i.value);if(v)i.value=INR(v);});
});
document.querySelectorAll(".percent").forEach(i=>{
i.addEventListener("blur",()=>{let v=clean(i.value);if(v)i.value=PCT(v);});
});

/* ---------- FINANCIAL ENGINE ---------- */

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}

function runScenario(type){

let riskAdj=1,oppAdj=1;
if(type==="best"){riskAdj=.6;oppAdj=.8;}
if(type==="worst"){riskAdj=1.5;oppAdj=1.2;}

calculate(type,riskAdj,oppAdj);
}

function calculate(label,riskAdj,oppAdj){

const leaseAmount=clean($("leaseAmount").value);
const loanAmount=clean($("loanAmount").value);
const ownFunds=Math.max(0,leaseAmount-loanAmount);

const loanRate=(clean($("loanRate").value)/100)/12;
const loanTenure=clean($("loanTenure").value);
const leaseTenure=clean($("leaseTenure").value);

const maintenance=clean($("maintenance").value);
const marketRent=clean($("marketRent").value);

const oppRate=((clean($("oppRate").value)/100)/12)*oppAdj;
const riskPremium=(clean($("riskPremium").value)/100)*riskAdj;

const EMI=emi(loanAmount,loanRate,loanTenure);

const totalEconomic=EMI*loanTenure-loanAmount + ownFunds*oppRate*leaseTenure;
const riskRent=(totalEconomic/leaseTenure)*(1+riskPremium);

const monthlySavings=marketRent-riskRent;
const yearlySavings=monthlySavings*12;
const termSavings=monthlySavings*leaseTenure;

let score=(monthlySavings/marketRent)*100;
score=Math.max(0,Math.min(100,score));

let verdict=" Neutral Zone";
if(score>20) verdict=" Lease Is Winning";
if(score<5) verdict=" Rent Is Safer";

$("results").innerHTML=`

<div class="metric">Own Funds Used</div>
<div class="bigNumber">${INR(ownFunds)}</div>

<div class="metric">EMI</div>
<div>${INR(EMI)}</div>

<div class="metric">Risk Adjusted Rent</div>
<div>${INR(riskRent)}</div>

<div class="metric">Monthly Savings</div>
<div class="bigNumber">${INR(monthlySavings)}</div>

<div class="metric">Yearly Savings</div>
<div>${INR(yearlySavings)}</div>

<div class="metric">Lease Term Savings</div>
<div>${INR(termSavings)}</div>
`;

$("verdict").innerText=verdict+" ("+label.toUpperCase()+")";
$("confidenceFill").style.width=score+"%";

lastResults={EMI,riskRent,monthlySavings,yearlySavings,termSavings,label,verdict};

renderProjection(termSavings,leaseTenure);

}

/* ---------- ADVANCED ANALYTICS CHART ---------- */

function renderProjection(termSavings,months){

let data=[];
let step=termSavings/months;

for(let i=1;i<=months;i++){
data.push(step*i);
}

if(projectionChart)projectionChart.destroy();

projectionChart=new Chart($("projectionChart"),{
type:"line",
data:{
labels:data.map((_,i)=>i+1),
datasets:[{label:"Projected Savings Growth",data:data}]
}
});

}

/* ---------- PROFESSIONAL PDF REPORT ---------- */

async function downloadPDF(){

if(!lastResults.EMI){
alert("Run analysis first");
return;
}

const {jsPDF}=window.jspdf;
const doc=new jsPDF();

doc.setFontSize(18);
doc.text("Lease vs Rent Financial Decision Report",20,20);

doc.setFontSize(12);
doc.text("Executive Summary",20,40);
doc.text("Verdict: "+lastResults.verdict,20,50);
doc.text("Scenario: "+lastResults.label,20,60);

doc.text("Financial Overview",20,80);
doc.text("EMI: "+INR(lastResults.EMI),20,90);
doc.text("Risk Adjusted Rent: "+INR(lastResults.riskRent),20,100);

doc.text("Savings Analysis",20,120);
doc.text("Monthly Savings: "+INR(lastResults.monthlySavings),20,130);
doc.text("Yearly Savings: "+INR(lastResults.yearlySavings),20,140);
doc.text("Total Lease Term Savings: "+INR(lastResults.termSavings),20,150);

doc.setFontSize(10);
doc.text("Generated by Lease vs Rent Fintech Decision Engine.",20,180);

doc.save("Lease_vs_Rent_Professional_Report.pdf");
}

</script>
</body>
</html>